"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const u=require("@rozenite/plugin-bridge"),r=require("react"),c=require("rxjs"),n=class n{constructor(){this.rozeniteClient=null,this.messagesToSend=new c.ReplaySubject,this.messagesFromDashboard=new c.Subject,this.messagesToSendSubscription=null}static getInstance(){return n.instance||(n.instance=new n),n.instance}static destroyInstance(){n.instance&&(n.instance.destroy(),n.instance=null)}setClient(e){this.messagesToSendSubscription&&(this.messagesToSendSubscription.unsubscribe(),this.messagesToSendSubscription=null),this.rozeniteClient&&this.rozeniteClient.close(),this.rozeniteClient=e,this.initialize().catch(s=>{console.error("[RozeniteConnector] Error initializing",s)})}destroy(){this.messagesToSendSubscription&&(this.messagesToSendSubscription.unsubscribe(),this.messagesToSendSubscription=null),this.rozeniteClient?.close(),this.messagesToSend.complete(),this.messagesFromDashboard.complete()}async initialize(){const e=this.rozeniteClient;if(!e)throw new Error("[RozeniteConnector] Client not set");this.messagesToSendSubscription&&(this.messagesToSendSubscription.unsubscribe(),this.messagesToSendSubscription=null);const s=()=>{this.messagesToSendSubscription&&this.messagesToSendSubscription.unsubscribe(),this.messagesToSendSubscription=this.messagesToSend.subscribe({next:t=>{e.send("message",t)}})};e.onMessage("init",()=>{const t=!!this.messagesToSendSubscription;s(),t||e.send("init","init response")}),e.onMessage("message",({type:t,payload:a})=>{this.messagesFromDashboard.next({type:t,payload:a})}),e.send("init","init message from client")}sendMessage(e,s){this.messagesToSend.next({type:e,payload:s})}listenToMessages(e){return this.messagesFromDashboard.subscribe({next:s=>e(s.type,s.payload)})}};n.instance=null;let i=n;const l="@ledgerhq/device-management-kit-devtools-rozenite",g=l;function d(){const o=u.useRozeniteDevToolsClient({pluginId:g}),[e,s]=r.useState(null);return r.useEffect(()=>{if(o){const t=i.getInstance();t.setClient(o),s(t)}},[o]),e}exports.RozeniteConnector=i;exports.useRozeniteConnector=d;
